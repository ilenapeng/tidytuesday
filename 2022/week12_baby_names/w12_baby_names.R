library(tidyverse)
library(extrafont)

babynames <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-03-22/babynames.csv')

# biblical names over time - from https://nameberry.com/list/682/biblical-baby-names/all
# list generated by copy-pasting from site, transferring to spreadsheet and running =CONCATENATE("'", A1, "',") to format into list for R
biblical_names = c('Abital','Abner','Abra','Abraham','Abram','Ada','Adah','Adam','Adina','Adino','Adlai','Adriel','Aeneas','Agrippa','Ahab','Alpheus','Amal','Amasa','Ami','AmmielAmon','Amos','Anan','Ananias','Andreas','Andrew','Anna','Apphia','Aquila','Aram','Areli','Ariel','Artemas','Asa','Asher','Atara','Athaliah','Avital','Azarel','Azariah','Azel','Aziel','Azriel','Azubah','Balthasar','Barak','Barnabas','Barnaby','Bartholomew','Baruch','Bathsheba','Benaiah','Benjamin','Berenice','Beriah','Bernice','Bethany','Bethel','Beulah','Bilhah','Boaz','Buz','Cain','Caleb','Candace','Carmel','Cephas','Chloe','Claudia','Cleopas','Cornelius','Crispus','Cyrus','Damaris','Daniel','Darius','Dathan','David','Deborah','Delilah','Dinah','Dionysius','Dorcas','Drusilla','Ebenezer','Eder','Ehud','Elam','Eli','Eliel','Eliezer','Elihu','Elijah','Elisha','Elisha','Elisheva','Elizabeth','Elon','Emmanuel','Enoch','Enos','Ephraim','Ephrath','Ephron','Erastus','Esau','Esdras','Esther','Ethan','Eunice','Eve','Ezekiel','Ezra','Felix','Festus','Gabriel','Gad','Gadiel','Gaius','Galilee','Gershon','Gideon','Gilead','Goliath','Gomer','Hadassah','Hagar','Haggith','Haman','Hannah','Haran','Havilah','Havilah','Heber','Helah','Heli','Hepzibah','Herod','Herodias','Hezekiah','Hillel','Hiram','Hodiah','Hosanna','Hosea','Huri','Ichabod','Ira','Isaac','Isaiah','Ishmael','Ishvi','Israel','Ithai','Ithiel','Jabez','Jabin','Jacob','Jadon','Jael','Jahel','Jair','James','Jamin','Japheth','Jarah','Jared','Jason','Javan','Jawad','Jaziel','Jeconiah','Jedediah','Jedidiah','Jehu','Jemima','Jemuel','Jeremiah','Jeremy','Jeriah','Jericho','Jerusha','Jescha','Jesse','Jesus','Jethro','Jezebel','Joachim','Joah','Joanna','Job','Joel','John','Jonah','Jonas','Jonathan','Joram','Joseph','Joses','Joshua','Josiah','Jotham','Jothan','Jubal','Judah','Judas','Jude','Judith','Julia','Junia','Justus','Kandake','Kemuel','Kenan','Keren','Keturah','Keziah','Laban','Lael','Lazarus','Leah','Lemuel','Levi','Lilith','Lois','Lucas','Lucius','Luke','Lydia','Magdalen','Magdalena','Mahlah','Mahlon','Malachi','Mara','Maria','Marie','Mark','Martha','Mary','Mattan','Matthew','Matthias','Mehitabel','Menahem','Merari','Micah','Micaiah','Micaiah','Michael','Michal','Milka','Miriam','Moab','Mordecai','Moses','Naamah','Nadab','Naomi','Naphtali','Narcissus','Nathan','Nathanael','Nathaniel','Nebo','Nehemiah','Nekoda','Neriah','Nicodemus','Noa','Noah','Noemi','Nogah','Obadiah','Obed','Omar','Omri','Ophir','Orpah','Oshea','Othniel','Pallu','Paul','Peninah','Penuel','Perez','Persis','Peter','Pharez','Phebe','Philemon','Philetus','Philip','Phineas','Phoebe','Pontius','Prisca','Priscilla','Rachel','Rahab','Ram','Raphael','Rebecca','Rebekah','Reuben','Reuel','Rhoda','Rochelle','Rufus','Ruth','Salome','Samson','Samuel','Sapphira','Sarah','Sarai','Sargon','Saul','Selah','Seraiah','Seth','Sharar','Shem','Sherah','Shifra','Shiloh','Shulammite','Silas','Silvanus','Simeon','Simon','Solomon','Stephan','Susana','Susannah','Syntyche','Tabitha','Talitha','Talmai','Tamar','Tamara','Tammuz','Tekoa','Thaddeus','Theophilus','Thomas','Timeus','Timon','Timothy','Tiras','Tirzah','Titus','Tobiah','Tobias','Tobit','Tryphena','Tryphosa','Urban','Uri','Uriah','Uriel','Uzzi','Vashti','Yael','Zaccai','Zachariah','Zachary','Zeb','Zebedee','Zebediah','Zebulon','Zedekiah','Zeke','Zibiah','Zilla','Zillah','Zilpah','Zimri','Zion','Zipporah','Zuriel')

# filter df based on biblical names
df_biblical <- subset(babynames, babynames$name %in% biblical_names)

# biblical names over time
df_over_time <- aggregate(df_biblical$n, by=list(year=df_biblical$year, sex=df_biblical$sex), FUN=sum)

df_over_time <- aggregate(df_biblical$prop, by=list(year=df_biblical$year, sex=df_biblical$sex), FUN=sum)

# plot
p_over_time <- ggplot(df_over_time, aes(x=year, y=x, color=sex)) + 
  geom_line(size=1.5) +
  scale_color_manual(values=c('#541388', '#2EC4B6')) +
  coord_flip() + 
  scale_x_reverse(limits=c(2020, 1880)) +
  scale_y_continuous(limits=c(-0.1, 0.5), breaks=c(0, 0.1, 0.2, 0.3, 0.4), labels=c('', '10', '20', '30% of US newborns', '')) + 
  labs(
    title="Biblical Names Have Become Less Common, Especially for Newborn Girls",
    subtitle="\nLines show the share of babies born in each year that were given a biblical\nname. Annotations show the most common names for each sex each year and \nwhether they are biblical (B) or not (N). None of the No. 1 most common\nnames for girls have been biblical since the 1960s.",
    caption="\nData from the Social Security Administration via Hadley Wickham's babynames R package\nGraphic by Ilena Peng for #TidyTuesday"
  ) +
  theme_minimal() +
  theme(
    text = element_text(family='Courier New'),
    plot.title = element_text(family='Courier New', face="bold", hjust=0.5, size=20),
    plot.subtitle = element_text(family='Courier New', hjust=0.5, size=18),
    plot.caption = element_text(family='Courier New', hjust=0.5, size=14),
    panel.grid.minor.x = element_blank(),
    axis.title = element_blank(),
    axis.text=element_text(color="black", size=16, face="bold"),
    legend.position = "none",
    plot.margin=margin(1,1,1,1, "cm"),
    plot.background=element_rect(fill="white")
  )
print(p_over_time)
ggsave("w12_babynames_raw.png", width=12.5, height=14, unit="in")

# FOR ANNOTATIONS
# top name each year
df_by_year <- babynames %>% group_by(year,sex) %>% arrange(desc(prop)) %>% slice(1)
view(df_by_year)

# females only, top names
df_yr_f <- babynames %>% filter(sex=='F') %>% group_by(year,sex) %>% arrange(desc(prop)) %>% slice(1)
view(df_yr_f)

# males only, top names
df_yr_m <- babynames %>% filter(sex=='M') %>% group_by(year,sex) %>% arrange(desc(prop)) %>% slice(1)
view(df_yr_m)

# get top 5 biblical names each year
df_biblical_top5 <- df_biblical %>% group_by(year,sex) %>% arrange(desc(prop)) %>% slice(1:3)
view(df_biblical_top5)


